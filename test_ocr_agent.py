#!/usr/bin/env python3
"""
–¢–µ—Å—Ç –∞–≥–µ–Ω—Ç–∞ –æ—á–∏—Å—Ç–∫–∏ OCR —Ç–µ–∫—Å—Ç–∞
"""

import os
import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –º–æ–¥—É–ª—è–º
sys.path.append(str(Path(__file__).parent / "kb_admin"))

def test_ocr_cleaning_agent():
    """–¢–µ—Å—Ç –∞–≥–µ–Ω—Ç–∞ –æ—á–∏—Å—Ç–∫–∏ OCR —Ç–µ–∫—Å—Ç–∞"""
    print("=== –¢–µ—Å—Ç –∞–≥–µ–Ω—Ç–∞ –æ—á–∏—Å—Ç–∫–∏ OCR —Ç–µ–∫—Å—Ç–∞ ===")
    
    from kb_admin.modules.core.smart_document_agent import SmartLibrarian
    from kb_admin.modules.core.knowledge_manager import KnowledgeBaseManager
    from kb_admin.modules.documents.pdf_processor import PDFProcessor
    
    # –°–æ–∑–¥–∞–µ–º SmartLibrarian
    kb_manager = KnowledgeBaseManager()
    pdf_processor = PDFProcessor()
    smart_librarian = SmartLibrarian(kb_manager, pdf_processor)
    
    # –†–µ–∞–ª—å–Ω—ã–π OCR —Ç–µ–∫—Å—Ç —Å –∫—Ä–∞–∫–æ–∑—è–±—Ä–∞–º–∏ (–∫–∞–∫ –≤—ã –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏)
    real_ocr_text = """
–°–ò–°–¢–ï–ú–ê –°–ï–†–¢–ò–§–ò–ö–ê–¶–ò–ò –í –û–ë–õ–ê–°–¢–ò –°–í–Ø–ó–ò –°–ï–†–¢–ò–§–ò–ö–ê–¢ –°–û–û–¢–í–ï–¢–°–¢–í–ò–Ø –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –Ω–æ–º–µ—Ä: –û–°-3-–°–¢-0274 –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: —Å 27 —è–Ω–≤–∞—Ä—è 2010–≥. –¥–æ 27 —è–Ω–≤–∞—Ä—è 2011–≥. –ê Scorer –ù–ê–°–¢–û–Ø–©–ò–ú –°–ï–†–¢–ò–§–ò–ö–ê–¢–û–ú –û–†–ì–ê–ù –ü–û –°–ï–†–¢–ò–§–ò–ö–ê–¶–ò–ò Te tT AHO ¬´II KC¬ª, 111024, –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ê–≤–∏–∞–º–æ—Ç–æ—Ä–Ω–∞—è, –¥. 8A {—Å–æ–∫—Ä–∞—à–µ–Ω–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∞ –ø–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –∞–ª—Ä–µ—Å –º–µ—Å—Ç–∞ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –£–î–û–°–¢–û–í–ï–†–Ø–ï–¢, –ß–¢–û ‚Äî –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—á–µ—Ç–æ–≤ ¬´–ë–∏–ª–ª-–ú–∞—Å—Ç–µ—Ä¬ª –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ epee na —Å–≤—è–∑–∏. pepe –∏—è (–®—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ |}, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è 2 –∏) (–í–µ—Ä—Å–∏—è –ü–û 7) –≤ —Å–æ—Å—Ç–∞–≤–µ —Å–æ–≥–ª–∞—Å–Ω–æ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—é, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è ‚Ññ TY 4251-010-47397453- 2009. –û –±—Ä –û–û–ù es 5 –ï–ï –ï–ï–ï–í–ï–ï–ï–†–´–ï–ï–†–ï–ï–ï –Ω–µ—Ö —É –∂–µ =: : i Bo a ee ae oe ae oe eo se ee Se SSS Sa –ü–†–û–ò–ó–í–û–î–ò–ú–´–ï –û–û–û ¬´–ò–Ω–ª–∞–π–Ω –¢–µ–ª–µ–∫–æ–º –°–æ–ª—é—à–∏—Å¬ª, 127521, –≥. –ú–æ—Å–∫–≤–∞, > (–í–∞—é–º–µ–Ω–æ–≤—è–Ω–∏–µ –∏–æ–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—è —Å—Ä–µ–¥—Å—Ç–≤–∞ —Å–≤—è–∑–∏ –∞–ª—Ä–µ—Å –º–µ—Å—Ç–∞ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è) —É–ª. –û–∫—Ç—è–±—Ä—å—Å–∫–∞—è, –¥. 72 –ù–ê –ü–†–ï–î–ü–†–ò–Ø–¢–ò–ò (–ó–ê–í–û–î–ï) OOO ¬´–ò–Ω–ª–∞–π–Ω –¢–µ–ª–µ–∫–æ–º –°–æ–ª—é—à–∏—Å¬ª, 127521, –≥. –ú–æ—Å–∫–≤–∞, (–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è (–∑–∞–≤–æ–ª–∞] - –∏–∑–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—è —Å—Ä–µ–¥—Å—Ç–≤–∞ —Å–≤—è—Ç–∏. –∞–¥—Ä–µ—Å –º–µ—Å—Ç–∞ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è) –µ–µ–µ –°–û–û–¢–í–ï–¢–°–¢–í–£–Æ–¢
    """
    
    print("–ò—Å—Ö–æ–¥–Ω—ã–π OCR —Ç–µ–∫—Å—Ç —Å –∫—Ä–∞–∫–æ–∑—è–±—Ä–∞–º–∏:")
    print(real_ocr_text)
    print(f"\n–î–ª–∏–Ω–∞ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞: {len(real_ocr_text)}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º API –∫–ª—é—á
    api_key = os.getenv("PROXYAPI_KEY") or os.getenv("PROXYAPI_API_KEY") or os.getenv("OPEN_AI_API_KEY")
    if not api_key:
        print("\n‚ö†Ô∏è API –∫–ª—é—á –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!")
        print("–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è PROXYAPI_API_KEY –∏–ª–∏ OPEN_AI_API_KEY")
        print("–ê–≥–µ–Ω—Ç –Ω–µ —Å–º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ API –∫–ª—é—á–∞")
        return
    
    print(f"\n‚úÖ API –∫–ª—é—á –Ω–∞—Å—Ç—Ä–æ–µ–Ω: {api_key[:10]}...")
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ë–ó
    existing_kbs = smart_librarian._get_existing_knowledge_bases()
    print(f"\nüìö –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π:")
    print(existing_kbs)
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –∞–≥–µ–Ω—Ç–∞ –æ—á–∏—Å—Ç–∫–∏
    print("\nüßπ –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≥–µ–Ω—Ç–∞ –æ—á–∏—Å—Ç–∫–∏ OCR...")
    
    # –°–∏–º—É–ª–∏—Ä—É–µ–º –∞–Ω–∞–ª–∏–∑ –æ—Ç Gemini
    gemini_analysis = """
    –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç Gemini:
    –î–æ–∫—É–º–µ–Ω—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –≤ –æ–±–ª–∞—Å—Ç–∏ —Å–≤—è–∑–∏.
    –ù–∞ –¥–æ–∫—É–º–µ–Ω—Ç–µ –≤–∏–¥–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã:
    - –ó–∞–≥–æ–ª–æ–≤–æ–∫ "–°–ï–†–¢–ò–§–ò–ö–ê–¢ –°–û–û–¢–í–ï–¢–°–¢–í–ò–Ø"
    - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –Ω–æ–º–µ—Ä: –û–°-3-–°–¢-0274
    - –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: —Å 27 —è–Ω–≤–∞—Ä—è 2010–≥. –¥–æ 27 —è–Ω–≤–∞—Ä—è 2011–≥.
    - –û—Ä–≥–∞–Ω –ø–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: –ê–ù–û ¬´–ò–ò–ö–°¬ª
    - –ê–¥—Ä–µ—Å: –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ê–≤–∏–∞–º–æ—Ç–æ—Ä–Ω–∞—è, –¥. 8A
    - –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—á–µ—Ç–æ–≤ ¬´–ë–∏–ª–ª-–ú–∞—Å—Ç–µ—Ä¬ª
    - –í–µ—Ä—Å–∏—è –ü–û: 7
    - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è: –¢–£ 4251-010-47397453-2009
    - –ò–∑–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—å: –û–û–û ¬´–ò–Ω–ª–∞–π–Ω –¢–µ–ª–µ–∫–æ–º –°–æ–ª—é—à–∏—Å¬ª
    - –ê–¥—Ä–µ—Å –∏–∑–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—è: –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –û–∫—Ç—è–±—Ä—å—Å–∫–∞—è, –¥. 72
    """
    
    try:
        clean_abstract = smart_librarian._create_ocr_cleaning_agent(real_ocr_text, gemini_analysis)
        
        # –ü–∞—Ä—Å–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
        parsed_result = smart_librarian._parse_agent_response(clean_abstract)
        
        print("\nüìä –ê–Ω–∞–ª–∏–∑ –∞–≥–µ–Ω—Ç–∞:")
        print(f"–ö–∞—á–µ—Å—Ç–≤–æ —Ç–µ–∫—Å—Ç–∞: {parsed_result.get('quality', '–ù–ï–ò–ó–í–ï–°–¢–ù–û')}")
        print(f"–û—Å–º—ã—Å–ª–µ–Ω–Ω–æ—Å—Ç—å: {parsed_result.get('meaningfulness', '–ù–ï–ò–ó–í–ï–°–¢–ù–û')}")
        print(f"–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –¥–ª—è KB: {parsed_result.get('kb_ready', '–ù–ï–ò–ó–í–ï–°–¢–ù–û')}")
        print(f"–ö–∞—Ç–µ–≥–æ—Ä–∏—è –ë–ó: {parsed_result.get('category', '–ù–ï–ò–ó–í–ï–°–¢–ù–û')}")
        
        print(f"\nüîó –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:")
        print(f"  OCR —Ç–µ–∫—Å—Ç: {len(real_ocr_text)} —Å–∏–º–≤–æ–ª–æ–≤")
        print(f"  –ê–Ω–∞–ª–∏–∑ Gemini: {len(gemini_analysis)} —Å–∏–º–≤–æ–ª–æ–≤")
        print(f"  –ò—Ç–æ–≥–æ–≤—ã–π abstract: {len(parsed_result.get('abstract', clean_abstract))} —Å–∏–º–≤–æ–ª–æ–≤")
        
        print("\nüìÑ –ß–∏—Å—Ç—ã–π abstract:")
        print("=" * 50)
        print(parsed_result.get('abstract', clean_abstract))
        print("=" * 50)
        
        print(f"\nüìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:")
        print(f"–ò—Å—Ö–æ–¥–Ω–∞—è –¥–ª–∏–Ω–∞ OCR: {len(real_ocr_text)}")
        print(f"–î–ª–∏–Ω–∞ –∞–Ω–∞–ª–∏–∑–∞ Gemini: {len(gemini_analysis)}")
        print(f"–ò—Ç–æ–≥–æ–≤–∞—è –¥–ª–∏–Ω–∞: {len(clean_abstract)}")
        print(f"–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ: {len(real_ocr_text) - len(clean_abstract)} —Å–∏–º–≤–æ–ª–æ–≤")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞—á–µ—Å—Ç–≤–æ –æ—á–∏—Å—Ç–∫–∏
        if "epee na —Å–≤—è–∑–∏" not in clean_abstract:
            print("‚úÖ –ö—Ä–∞–∫–æ–∑—è–±—Ä—ã 'epee na —Å–≤—è–∑–∏' —É–¥–∞–ª–µ–Ω—ã")
        else:
            print("‚ùå –ö—Ä–∞–∫–æ–∑—è–±—Ä—ã 'epee na —Å–≤—è–∑–∏' –Ω–µ —É–¥–∞–ª–µ–Ω—ã")
            
        if "–ï–ï–ï–í–ï–ï–ï–†–´–ï–ï–†–ï–ï–ï" not in clean_abstract:
            print("‚úÖ –ö—Ä–∞–∫–æ–∑—è–±—Ä—ã '–ï–ï–ï–í–ï–ï–ï–†–´–ï–ï–†–ï–ï–ï' —É–¥–∞–ª–µ–Ω—ã")
        else:
            print("‚ùå –ö—Ä–∞–∫–æ–∑—è–±—Ä—ã '–ï–ï–ï–í–ï–ï–ï–†–´–ï–ï–†–ï–ï–ï' –Ω–µ —É–¥–∞–ª–µ–Ω—ã")
            
        if "ee ae oe ae oe eo se ee Se SSS Sa" not in clean_abstract:
            print("‚úÖ –ö—Ä–∞–∫–æ–∑—è–±—Ä—ã 'ee ae oe ae oe eo se ee Se SSS Sa' —É–¥–∞–ª–µ–Ω—ã")
        else:
            print("‚ùå –ö—Ä–∞–∫–æ–∑—è–±—Ä—ã 'ee ae oe ae oe eo se ee Se SSS Sa' –Ω–µ —É–¥–∞–ª–µ–Ω—ã")
            
        if "–°–ò–°–¢–ï–ú–ê –°–ï–†–¢–ò–§–ò–ö–ê–¶–ò–ò" in clean_abstract:
            print("‚úÖ –ü–æ–ª–µ–∑–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è '–°–ò–°–¢–ï–ú–ê –°–ï–†–¢–ò–§–ò–ö–ê–¶–ò–ò' —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞")
        else:
            print("‚ùå –ü–æ–ª–µ–∑–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è '–°–ò–°–¢–ï–ú–ê –°–ï–†–¢–ò–§–ò–ö–ê–¶–ò–ò' –ø–æ—Ç–µ—Ä—è–Ω–∞")
            
        if "–ë–∏–ª–ª-–ú–∞—Å—Ç–µ—Ä" in clean_abstract:
            print("‚úÖ –ü–æ–ª–µ–∑–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è '–ë–∏–ª–ª-–ú–∞—Å—Ç–µ—Ä' —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞")
        else:
            print("‚ùå –ü–æ–ª–µ–∑–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è '–ë–∏–ª–ª-–ú–∞—Å—Ç–µ—Ä' –ø–æ—Ç–µ—Ä—è–Ω–∞")
        
        print("\nüéâ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!")
        
    except Exception as e:
        print(f"\n‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≥–µ–Ω—Ç–∞: {e}")
        import traceback
        traceback.print_exc()

def test_full_ocr_cleaning_workflow():
    """–¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ—á–∏—Å—Ç–∫–∏ OCR"""
    print("\n=== –¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ—á–∏—Å—Ç–∫–∏ OCR ===")
    
    from kb_admin.modules.core.smart_document_agent import SmartLibrarian
    from kb_admin.modules.core.knowledge_manager import KnowledgeBaseManager
    from kb_admin.modules.documents.pdf_processor import PDFProcessor
    
    # –°–æ–∑–¥–∞–µ–º SmartLibrarian
    kb_manager = KnowledgeBaseManager()
    pdf_processor = PDFProcessor()
    smart_librarian = SmartLibrarian(kb_manager, pdf_processor)
    
    # –¢–µ—Å—Ç–æ–≤—ã–π OCR —Ç–µ–∫—Å—Ç
    test_ocr_text = """
@#$%^&*()_+{}|:<>?[]\\;'\",./~`1234567890-=qwertyuiopasdfghjklzxcvbnm
–°–ò–°–¢–ï–ú–ê –°–ï–†–¢–ò–§–ò–ö–ê–¶–ò–ò –í –û–ë–õ–ê–°–¢–ò –°–í–Ø–ó–ò
@#$%^&*()_+{}|:<>?[]\\;'\",./~`1234567890-=qwertyuiopasdfghjklzxcvbnm
–°–ï–†–¢–ò–§–ò–ö–ê–¢ –°–û–û–¢–í–ï–¢–°–¢–í–ò–Ø –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –Ω–æ–º–µ—Ä: –û–°-3-–°–¢-0274
@#$%^&*()_+{}|:<>?[]\\;'\",./~`1234567890-=qwertyuiopasdfghjklzxcvbnm
–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: —Å 27 —è–Ω–≤–∞—Ä—è 2010–≥. –¥–æ 27 —è–Ω–≤–∞—Ä—è 2011–≥.
@#$%^&*()_+{}|:<>?[]\\;'\",./~`1234567890-=qwertyuiopasdfghjklzxcvbnm
–ù–ê–°–¢–û–Ø–©–ò–ú –°–ï–†–¢–ò–§–ò–ö–ê–¢–û–ú –û–†–ì–ê–ù –ü–û –°–ï–†–¢–ò–§–ò–ö–ê–¶–ò–ò
@#$%^&*()_+{}|:<>?[]\\;'\",./~`1234567890-=qwertyuiopasdfghjklzxcvbnm
AHO ¬´II KC¬ª, 111024, –≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ê–≤–∏–∞–º–æ—Ç–æ—Ä–Ω–∞—è, –¥. 8A
@#$%^&*()_+{}|:<>?[]\\;'\",./~`1234567890-=qwertyuiopasdfghjklzxcvbnm
–£–î–û–°–¢–û–í–ï–†–Ø–ï–¢, –ß–¢–û –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—á–µ—Ç–æ–≤ ¬´–ë–∏–ª–ª-–ú–∞—Å—Ç–µ—Ä¬ª
@#$%^&*()_+{}|:<>?[]\\;'\",./~`1234567890-=qwertyuiopasdfghjklzxcvbnm
—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É—Å–ª–æ–≤–∏—è ‚Ññ TY 4251-010-47397453-2009
@#$%^&*()_+{}|:<>?[]\\;'\",./~`1234567890-=qwertyuiopasdfghjklzxcvbnm
–ü–†–û–ò–ó–í–û–î–ò–ú–´–ï –û–û–û ¬´–ò–Ω–ª–∞–π–Ω –¢–µ–ª–µ–∫–æ–º –°–æ–ª—é—à–∏—Å¬ª, 127521, –≥. –ú–æ—Å–∫–≤–∞
@#$%^&*()_+{}|:<>?[]\\;'\",./~`1234567890-=qwertyuiopasdfghjklzxcvbnm
—É–ª. –û–∫—Ç—è–±—Ä—å—Å–∫–∞—è, –¥. 72 –ù–ê –ü–†–ï–î–ü–†–ò–Ø–¢–ò–ò (–ó–ê–í–û–î–ï)
@#$%^&*()_+{}|:<>?[]\\;'\",./~`1234567890-=qwertyuiopasdfghjklzxcvbnm
    """
    
    print("–ò—Å—Ö–æ–¥–Ω—ã–π OCR —Ç–µ–∫—Å—Ç —Å –º—É—Å–æ—Ä–æ–º:")
    print(test_ocr_text[:200] + "...")
    print(f"–î–ª–∏–Ω–∞: {len(test_ocr_text)}")
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ—á–∏—Å—Ç–∫–∏
    print("\nüßπ –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ—á–∏—Å—Ç–∫–∏ OCR...")
    try:
        cleaned_text = smart_librarian._clean_ocr_text(test_ocr_text)
        
        print("\nüìÑ –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏:")
        print("=" * 50)
        print(cleaned_text)
        print("=" * 50)
        
        print(f"\nüìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:")
        print(f"–ò—Å—Ö–æ–¥–Ω–∞—è –¥–ª–∏–Ω–∞: {len(test_ocr_text)}")
        print(f"–û—á–∏—â–µ–Ω–Ω–∞—è –¥–ª–∏–Ω–∞: {len(cleaned_text)}")
        print(f"–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ: {len(test_ocr_text) - len(cleaned_text)} —Å–∏–º–≤–æ–ª–æ–≤")
        
        print("\nüéâ –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!")
        
    except Exception as e:
        print(f"\n‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞: {e}")
        import traceback
        traceback.print_exc()

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    print("üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ –æ—á–∏—Å—Ç–∫–∏ OCR —Ç–µ–∫—Å—Ç–∞\n")
    
    try:
        # –¢–µ—Å—Ç 1: –ê–≥–µ–Ω—Ç –æ—á–∏—Å—Ç–∫–∏ OCR
        test_ocr_cleaning_agent()
        
        # –¢–µ—Å—Ç 2: –ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ—á–∏—Å—Ç–∫–∏
        test_full_ocr_cleaning_workflow()
        
        print("\n=== –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ===")
        print("‚úÖ –ê–≥–µ–Ω—Ç –æ—á–∏—Å—Ç–∫–∏ OCR —Å–æ–∑–¥–∞–Ω")
        print("‚úÖ –ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ—á–∏—Å—Ç–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç")
        
        print("\n=== –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ ===")
        print("1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è PROXYAPI_API_KEY –¥–ª—è —Ä–∞–±–æ—Ç—ã –∞–≥–µ–Ω—Ç–∞")
        print("2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö PDF –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ")
        print("3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ —Ñ–∞–π–ª–µ kb_admin.log")
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: {e}")
        import traceback
        traceback.print_exc()

if __name__ == "__main__":
    main()
