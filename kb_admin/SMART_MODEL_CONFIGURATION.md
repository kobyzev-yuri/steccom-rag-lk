# ü§ñ –£–ú–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ú–û–î–ï–õ–ï–ô –î–õ–Ø KB ADMIN

## üìÖ –î–∞—Ç–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
**8 –æ–∫—Ç—è–±—Ä—è 2025, 15:10 MSK**

## ‚úÖ –ß–¢–û –ò–ù–¢–ï–ì–†–ò–†–û–í–ê–ù–û:

### 1. **–£–º–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π** üß†
- **ProxyAPI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ GPT-4o —á–µ—Ä–µ–∑ proxyapi.ru
- **–õ–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏**: Ollama —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º–∏ —Ç–∞–π–º–∞—É—Ç–∞–º–∏ (120 —Å–µ–∫)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä**: –ù–∞ –æ—Å–Ω–æ–≤–µ USE_PROXYAPI –≤ config.env

### 2. **–£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã** ‚è±Ô∏è
- **Ollama**: 120 —Å–µ–∫—É–Ω–¥ (–±—ã–ª–æ 10) –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π
- **ProxyAPI**: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã OpenAI
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: Graceful fallback –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ AI

### 3. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ config.env** ‚öôÔ∏è
```env
# ProxyAPI Configuration
PROXYAPI_BASE_URL=https://api.proxyapi.ru/openai/v1
PROXYAPI_API_KEY=sk-xF20r7G4tq9ezBMNKIjCPvva2io4S8FV
PROXYAPI_CHAT_MODEL=gpt-4o

# Model Selection
USE_PROXYAPI=true
```

## üöÄ **–ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê:**

### ‚úÖ **ProxyAPI (GPT-4o):**
- ‚ö° **–ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã** (1-2 –º–∏–Ω—É—Ç—ã –≤–º–µ—Å—Ç–æ 10+ –º–∏–Ω—É—Ç)
- üéØ **–í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ** –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤
- üìä **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö** —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
- üîß **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –º–µ–Ω—å—à–µ —Ç–∞–π–º–∞—É—Ç–æ–≤

### ‚úÖ **Ollama (–ª–æ–∫–∞–ª—å–Ω—ã–µ –º–æ–¥–µ–ª–∏):**
- üîí **–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å** - –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–∫–∏–¥–∞—é—Ç —Å–µ—Ä–≤–µ—Ä
- üí∞ **–≠–∫–æ–Ω–æ–º–∏—è** - –Ω–µ—Ç –∑–∞—Ç—Ä–∞—Ç –Ω–∞ API
- üõ†Ô∏è **–ù–∞—Å—Ç—Ä–æ–π–∫–∞** - –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –º–æ–¥–µ–ª—è–º–∏
- ‚è±Ô∏è **–£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã** –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π

## üéØ **–ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢:**

### 1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏** ü§ñ
```python
# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
use_proxyapi = os.getenv("USE_PROXYAPI", "false").lower() == "true"

if use_proxyapi:
    # GPT-4o —á–µ—Ä–µ–∑ ProxyAPI - –±—ã—Å—Ç—Ä–æ –∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ
    rag = MultiKBRAG(
        chat_provider="proxyapi",
        chat_model="gpt-4o",
        proxy_base_url="https://api.proxyapi.ru/openai/v1",
        proxy_api_key=os.getenv("PROXYAPI_API_KEY"),
        temperature=0.2
    )
else:
    # –õ–æ–∫–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å Ollama - –ø—Ä–∏–≤–∞—Ç–Ω–æ –∏ —ç–∫–æ–Ω–æ–º–∏—á–Ω–æ
    rag = MultiKBRAG()  # timeout=120 —Å–µ–∫—É–Ω–¥
```

### 2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** üõ°Ô∏è
```python
try:
    # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ç–∞–π–º–∞—É—Ç –¥–ª—è Ollama
    original_timeout = rag.chat_model.timeout
    rag.chat_model.timeout = 60  # 60 —Å–µ–∫—É–Ω–¥
    
    response = rag.chat_model.invoke(prompt)
    answer = response.content
    
except Exception as ai_error:
    # –ï—Å–ª–∏ AI –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
    st.warning(f"AI –º–æ–¥–µ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞: {ai_error}")
    st.info("–ü–æ–∫–∞–∑—ã–≤–∞—é –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –±–µ–∑ AI-–æ—Ç–≤–µ—Ç–∞...")
    answer = None
```

## üìä **–†–ï–ó–£–õ–¨–¢–ê–¢–´:**

### ‚úÖ **–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- **–£–º–Ω—ã–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏** –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- **–ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã** —á–µ—Ä–µ–∑ GPT-4o (ProxyAPI)
- **–ù–∞–¥–µ–∂–Ω–∞—è —Ä–∞–±–æ—Ç–∞** –ª–æ–∫–∞–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º–∏ —Ç–∞–π–º–∞—É—Ç–∞–º–∏
- **Graceful fallback** –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ AI
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏** –ø—Ä–∏ –ª—é–±—ã—Ö –æ—à–∏–±–∫–∞—Ö

### üéØ **–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã:**
```
–í–æ–ø—Ä–æ—Å: "SBD –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø–æ—Å—ã–ª–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è - –∫–∞–∫ –æ–Ω–∞ –≤—ã–≥–ª—è–¥–∏—Ç?"

ProxyAPI (GPT-4o):
‚úÖ –û—Ç–≤–µ—Ç –∑–∞ 30-60 —Å–µ–∫—É–Ω–¥
‚úÖ –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç

Ollama (–ª–æ–∫–∞–ª—å–Ω—ã–µ):
‚úÖ –û—Ç–≤–µ—Ç –∑–∞ 2-5 –º–∏–Ω—É—Ç
‚úÖ –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å
```

## üéâ **–ò–¢–û–ì:**

**KB Admin —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É–º–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º–æ–¥–µ–ª–µ–π!**

- ‚úÖ **ProxyAPI** –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ **Ollama** –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º–∏ —Ç–∞–π–º–∞—É—Ç–∞–º–∏
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä** –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ **–ù–∞–¥–µ–∂–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** —Å fallback –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ã

**–¢–µ–ø–µ—Ä—å —É–º–Ω—ã–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–æ –∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ! üöÄ**

---
*–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø–æ –æ–±—Ä–∞–∑—Ü—É ai_billing —Å –∞–¥–∞–ø—Ç–∞—Ü–∏–µ–π –¥–ª—è KB Admin*










